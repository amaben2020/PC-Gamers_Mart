{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/user/Desktop/Proshop Ecommerce/frontend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/user/Desktop/Proshop Ecommerce/frontend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/user/Desktop/Proshop Ecommerce/frontend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{getOrderDetails}from\"./../../actions/orderActions\";import React,{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{ORDER_DELIVER_RESET}from\"./../../constants/orderConstants\";import{PayPalButton}from\"react-paypal-button-v2\";import{Col,ListGroup,Image,Card,Row,Button}from\"react-bootstrap\";import Loading from\"./../../messages/Loading\";import ErrorMessage from\"./../../messages/ErrorMessage\";import{payOrder}from\"../../actions/orderActions\";import{Link}from\"react-router-dom\";import axios from\"axios\";import{ORDER_PAY_RESET}from\"./../../constants/orderConstants\";import{deliverOrder}from\"./../../actions/orderActions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var OrderScreen=function OrderScreen(_ref){var match=_ref.match,history=_ref.history;//creating a state that holds the sdk script when created\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;//extracting the ID from the url\nvar orderId=match.params.id;var orderDetails=useSelector(function(state){return state.orderDetails;});var order=orderDetails.order,loading=orderDetails.loading,error=orderDetails.error;console.log(\"This is order:\",order);var pay=localStorage.getItem(\"paymentMethod\")?JSON.parse(localStorage.getItem(\"paymentMethod\")):\"\";console.log(pay);var shippingAddress=useSelector(function(state){return state.cart.shippingAdd;});if(!loading){var addDecimals=function addDecimals(num){return Math.round(num*100)/100;};//creating the cart.ItemsPrice by adding the item price * quantity\norder.itemsPrice=addDecimals(order.orderItems.reduce(function(acc,item){return acc+item.price*item.qty;},0));}var orderPay=useSelector(function(state){return state.orderPay;});var loadingPay=orderPay.loading,successPay=orderPay.success;//console.log(\"ORDERPAY:\", orderPay);\nvar orderDeliver=useSelector(function(state){return state.orderDeliver;});var loadingDeliver=orderDeliver.loading,successDeliver=orderDeliver.success;var successPaymentHandler=function successPaymentHandler(paymentResult){console.log(\"FROM PAYPAL:\",paymentResult);dispatch(payOrder(orderId,paymentResult));};var dispatch=useDispatch();// console.log(cart.cartItems)//product, countInStock,name, price etc\n//we use useEffect to dynamically update our state based on parameters\nuseEffect(function(){if(!userInfo){history.push(\"login\");}//getting the clientId from backend\nvar addPayPalScript=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,clientId,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get(\"/api/config/paypal\");case 2:_yield$axios$get=_context.sent;clientId=_yield$axios$get.data;script=document.createElement(\"script\");//this creates a script tag <script></script>\nscript.type=\"text/javascript\";script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(clientId);script.async=true;//when the component mounts with the SDK, lets set the SDK state to true\nscript.onload=function(){setSdkReady(true);};//add the script to the body after it loads\ndocument.body.appendChild(script);//we now check from our orderPayReducer if success is true\ncase 10:case\"end\":return _context.stop();}}},_callee);}));return function addPayPalScript(){return _ref2.apply(this,arguments);};}();addPayPalScript();//This loads the order again but this time around its paid\nif(!order||successPay){dispatch({type:ORDER_PAY_RESET});dispatch(getOrderDetails(orderId));dispatch({type:ORDER_DELIVER_RESET});}else if(!order.isPaid){if(!window.paypal){addPayPalScript();}else{setSdkReady(true);}}},[dispatch,orderId,successDeliver,successPay]);var deliverHandler=function deliverHandler(){dispatch(deliverOrder(order));};// localStorage.setItem(\"success\", JSON.parse(successPay));\n// console.log(\"successPay:\", successPay);\nreturn/*#__PURE__*/_jsx(_Fragment,{children:loading?/*#__PURE__*/_jsx(Loading,{}):error?/*#__PURE__*/_jsx(ErrorMessage,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Place Order \",order._id,\" \"]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:8,children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Shipping\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name: \"}),\" \",order.user.name]}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsxs(\"a\",{href:\"mailto: \".concat(order.user.email),children:[\"Email: \",order.user.email]})}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Address: \"}),\" \",shippingAddress.address,order.isDelivered&&order.deliveredAt]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"State: \"}),\" \",shippingAddress.state]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"LGA: \"}),\" \",shippingAddress.lga]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Landmark: \"}),\" \",shippingAddress.homeLandmark]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"City: \"}),\" \",shippingAddress.city]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Postal Code: \"}),\" \",shippingAddress.postalCode]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Country: \"}),\" \",shippingAddress.country]})]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Method: \"}),\" \",pay]}),successPay?/*#__PURE__*/_jsxs(ErrorMessage,{variant:\"success\",children:[\"Paid by \",order.user.name]}):/*#__PURE__*/_jsxs(ErrorMessage,{variant:\"danger\",children:[\"Not paid \",order.paidAt]})]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Items\"}),order.orderItems.length===0?/*#__PURE__*/_jsx(ErrorMessage,{children:\"Your order is empty\"}):/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:order.orderItems.map(function(item,index){return/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Image,{src:item.image,alt:item.name,fluid:true,rounded:true})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.product),children:item.name})}),/*#__PURE__*/_jsxs(Col,{md:4,children:[item.qty,\" * $\",item.price,\" = $\",item.qty*item.price]})]})},index);})})]})]})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{className:\"my-3 shadow-sm p-1 mb-1 bg-white rounded\",children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Summary\"}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Items\"}),/*#__PURE__*/_jsxs(Col,{children:[\" \",\"\\u20A6 \",order.itemsPrice.toLocaleString(\"en\")]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Shipping\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.shippingPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Tax\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.taxPrice]})]})})]}),/*#__PURE__*/_jsx(ListGroup.Item,{children:error&&/*#__PURE__*/_jsxs(ErrorMessage,{variant:\"danger\",children:[\" \",error]})}),!order.isPaid&&/*#__PURE__*/ //making sure the product hasn't been paid for\n_jsxs(ListGroup.Item,{children:[loadingPay&&/*#__PURE__*/_jsx(Loading,{}),!sdkReady?/*#__PURE__*/_jsx(Loading,{}):/*#__PURE__*/_jsx(PayPalButton,{amount:order.itemsPrice,onSuccess:successPaymentHandler})]}),loadingDeliver&&/*#__PURE__*/_jsx(Loading,{}),userInfo&&userInfo.isAdmin&&order.isPaid&&!order.isDelivered&&/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Button,{onClick:deliverHandler,type:\"button\",className:\"btn btn-block\",children:\"Mark as delivered\"})})]})})})]})]})});};export default OrderScreen;","map":{"version":3,"sources":["C:/Users/user/Desktop/Proshop Ecommerce/frontend/frontend/src/components/screen/OrderScreen.jsx"],"names":["getOrderDetails","React","useEffect","useState","useDispatch","useSelector","ORDER_DELIVER_RESET","PayPalButton","Col","ListGroup","Image","Card","Row","Button","Loading","ErrorMessage","payOrder","Link","axios","ORDER_PAY_RESET","deliverOrder","OrderScreen","match","history","sdkReady","setSdkReady","userLogin","state","userInfo","orderId","params","id","orderDetails","order","loading","error","console","log","pay","localStorage","getItem","JSON","parse","shippingAddress","cart","shippingAdd","addDecimals","num","Math","round","itemsPrice","orderItems","reduce","acc","item","price","qty","orderPay","loadingPay","successPay","success","orderDeliver","loadingDeliver","successDeliver","successPaymentHandler","paymentResult","dispatch","push","addPayPalScript","get","clientId","data","script","document","createElement","type","src","async","onload","body","appendChild","isPaid","window","paypal","deliverHandler","_id","user","name","email","address","isDelivered","deliveredAt","lga","homeLandmark","city","postalCode","country","paidAt","length","map","index","image","product","toLocaleString","shippingPrice","taxPrice","isAdmin"],"mappings":"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","sourcesContent":["import { getOrderDetails } from \"./../../actions/orderActions\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { ORDER_DELIVER_RESET } from \"./../../constants/orderConstants\";\r\nimport { PayPalButton } from \"react-paypal-button-v2\";\r\nimport { Col, ListGroup, Image, Card, Row, Button } from \"react-bootstrap\";\r\nimport Loading from \"./../../messages/Loading\";\r\nimport ErrorMessage from \"./../../messages/ErrorMessage\";\r\nimport { payOrder } from \"../../actions/orderActions\";\r\nimport { Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { ORDER_PAY_RESET } from \"./../../constants/orderConstants\";\r\nimport { deliverOrder } from \"./../../actions/orderActions\";\r\n\r\nconst OrderScreen = ({ match, history }) => {\r\n\t//creating a state that holds the sdk script when created\r\n\tconst [sdkReady, setSdkReady] = useState(false);\r\n\r\n\tconst userLogin = useSelector((state) => state.userLogin);\r\n\tconst { userInfo } = userLogin;\r\n\r\n\t//extracting the ID from the url\r\n\tconst orderId = match.params.id;\r\n\r\n\tconst orderDetails = useSelector((state) => state.orderDetails);\r\n\r\n\tconst { order, loading, error } = orderDetails;\r\n\tconsole.log(\"This is order:\", order);\r\n\r\n\tconst pay = localStorage.getItem(\"paymentMethod\")\r\n\t\t? JSON.parse(localStorage.getItem(\"paymentMethod\"))\r\n\t\t: \"\";\r\n\tconsole.log(pay);\r\n\r\n\tconst shippingAddress = useSelector((state) => state.cart.shippingAdd);\r\n\r\n\tif (!loading) {\r\n\t\tconst addDecimals = (num) => {\r\n\t\t\treturn Math.round(num * 100) / 100;\r\n\t\t};\r\n\r\n\t\t//creating the cart.ItemsPrice by adding the item price * quantity\r\n\t\torder.itemsPrice = addDecimals(\r\n\t\t\torder.orderItems.reduce((acc, item) => acc + item.price * item.qty, 0)\r\n\t\t);\r\n\t}\r\n\r\n\tconst orderPay = useSelector((state) => state.orderPay);\r\n\tconst { loading: loadingPay, success: successPay } = orderPay;\r\n\t//console.log(\"ORDERPAY:\", orderPay);\r\n\r\n\tconst orderDeliver = useSelector((state) => state.orderDeliver);\r\n\tconst { loading: loadingDeliver, success: successDeliver } = orderDeliver;\r\n\r\n\tconst successPaymentHandler = (paymentResult) => {\r\n\t\tconsole.log(\"FROM PAYPAL:\", paymentResult);\r\n\t\tdispatch(payOrder(orderId, paymentResult));\r\n\t};\r\n\r\n\tconst dispatch = useDispatch();\r\n\t// console.log(cart.cartItems)//product, countInStock,name, price etc\r\n\r\n\t//we use useEffect to dynamically update our state based on parameters\r\n\tuseEffect(() => {\r\n\t\tif (!userInfo) {\r\n\t\t\thistory.push(\"login\");\r\n\t\t}\r\n\t\t//getting the clientId from backend\r\n\t\tconst addPayPalScript = async () => {\r\n\t\t\tconst { data: clientId } = await axios.get(\"/api/config/paypal\");\r\n\t\t\tconst script = document.createElement(\"script\"); //this creates a script tag <script></script>\r\n\t\t\tscript.type = \"text/javascript\";\r\n\t\t\tscript.src = `https://www.paypal.com/sdk/js?client-id=${clientId}`;\r\n\t\t\tscript.async = true;\r\n\t\t\t//when the component mounts with the SDK, lets set the SDK state to true\r\n\t\t\tscript.onload = () => {\r\n\t\t\t\tsetSdkReady(true);\r\n\t\t\t};\r\n\t\t\t//add the script to the body after it loads\r\n\t\t\tdocument.body.appendChild(script);\r\n\t\t\t//we now check from our orderPayReducer if success is true\r\n\t\t};\r\n\t\taddPayPalScript();\r\n\t\t//This loads the order again but this time around its paid\r\n\t\tif (!order || successPay) {\r\n\t\t\tdispatch({ type: ORDER_PAY_RESET });\r\n\t\t\tdispatch(getOrderDetails(orderId));\r\n\t\t\tdispatch({ type: ORDER_DELIVER_RESET });\r\n\t\t} else if (!order.isPaid) {\r\n\t\t\tif (!window.paypal) {\r\n\t\t\t\taddPayPalScript();\r\n\t\t\t} else {\r\n\t\t\t\tsetSdkReady(true);\r\n\t\t\t}\r\n\t\t}\r\n\t}, [dispatch, orderId, successDeliver, successPay]);\r\n\r\n\tconst deliverHandler = () => {\r\n\t\tdispatch(deliverOrder(order));\r\n\t};\r\n\r\n\t// localStorage.setItem(\"success\", JSON.parse(successPay));\r\n\t// console.log(\"successPay:\", successPay);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{loading ? (\r\n\t\t\t\t<Loading />\r\n\t\t\t) : error ? (\r\n\t\t\t\t<ErrorMessage variant=\"danger\">{error}</ErrorMessage>\r\n\t\t\t) : (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<h1>Place Order {order._id} </h1>\r\n\r\n\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t<Col md={8}>\r\n\t\t\t\t\t\t\t<ListGroup variant=\"flush\">\r\n\t\t\t\t\t\t\t\t<ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t<h2>Shipping</h2>\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t<strong>Name: </strong> {order.user.name}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t<a href={`mailto: ${order.user.email}`}>\r\n\t\t\t\t\t\t\t\t\t\t\tEmail: {order.user.email}\r\n\t\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t<strong>Address: </strong> {shippingAddress.address}\r\n\t\t\t\t\t\t\t\t\t\t{order.isDelivered && order.deliveredAt}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t<strong>State: </strong> {shippingAddress.state}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t<strong>LGA: </strong> {shippingAddress.lga}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t<strong>Landmark: </strong> {shippingAddress.homeLandmark}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t<strong>City: </strong> {shippingAddress.city}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t<strong>Postal Code: </strong> {shippingAddress.postalCode}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t<strong>Country: </strong> {shippingAddress.country}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\r\n\t\t\t\t\t\t\t\t<ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t<h2>Payment Method</h2>\r\n\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\t<strong>Method: </strong> {pay}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t{successPay ? (\r\n\t\t\t\t\t\t\t\t\t\t<ErrorMessage variant=\"success\">\r\n\t\t\t\t\t\t\t\t\t\t\tPaid by {order.user.name}\r\n\t\t\t\t\t\t\t\t\t\t</ErrorMessage>\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t<ErrorMessage variant=\"danger\">\r\n\t\t\t\t\t\t\t\t\t\t\tNot paid {order.paidAt}\r\n\t\t\t\t\t\t\t\t\t\t</ErrorMessage>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\r\n\t\t\t\t\t\t\t\t<ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t<h2>Order Items</h2>\r\n\r\n\t\t\t\t\t\t\t\t\t{order.orderItems.length === 0 ? (\r\n\t\t\t\t\t\t\t\t\t\t<ErrorMessage>Your order is empty</ErrorMessage>\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t<ListGroup variant=\"flush\">\r\n\t\t\t\t\t\t\t\t\t\t\t{order.orderItems.map((item, index) => (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<ListGroup.Item key={index}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Image\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={item.image}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={item.name}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfluid\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trounded\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Link to={`/product/${item.product}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{item.name}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col md={4}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{item.qty} * ${item.price} = $\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{item.qty * item.price}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t\t</ListGroup>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\t\t\t\t\t\t\t</ListGroup>\r\n\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t<Col md={4}>\r\n\t\t\t\t\t\t\t<Card className=\"my-3 shadow-sm p-1 mb-1 bg-white rounded\">\r\n\t\t\t\t\t\t\t\t<ListGroup variant=\"flush\">\r\n\t\t\t\t\t\t\t\t\t<ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t<h2>Order Summary</h2>\r\n\t\t\t\t\t\t\t\t\t\t<ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Col>Items</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\" \"}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t&#8358; {order.itemsPrice.toLocaleString(\"en\")}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t<ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Col>Shipping</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Col>${order.shippingPrice}</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t<ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Col>Tax</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Col>${order.taxPrice}</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\r\n\t\t\t\t\t\t\t\t\t<ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t{error && (\r\n\t\t\t\t\t\t\t\t\t\t\t<ErrorMessage variant=\"danger\"> {error}</ErrorMessage>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t{!order.isPaid && ( //making sure the product hasn't been paid for\r\n\t\t\t\t\t\t\t\t\t\t<ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t\t{loadingPay && <Loading />}\r\n\t\t\t\t\t\t\t\t\t\t\t{!sdkReady ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Loading />\r\n\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<PayPalButton\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tamount={order.itemsPrice}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSuccess={successPaymentHandler}\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t{loadingDeliver && <Loading />}\r\n\t\t\t\t\t\t\t\t\t{userInfo &&\r\n\t\t\t\t\t\t\t\t\t\tuserInfo.isAdmin &&\r\n\t\t\t\t\t\t\t\t\t\torder.isPaid &&\r\n\t\t\t\t\t\t\t\t\t\t!order.isDelivered && (\r\n\t\t\t\t\t\t\t\t\t\t\t<ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={deliverHandler}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"btn btn-block\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tMark as delivered\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t</ListGroup.Item>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</ListGroup>\r\n\t\t\t\t\t\t\t</Card>\r\n\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t</Row>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\t\t</>\r\n\t);\r\n};\r\n\r\nexport default OrderScreen;\r\n"]},"metadata":{},"sourceType":"module"}